{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Documents/these/infodoc/react-app-setup/app/api/literature-review/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { spawn } from \"child_process\"\nimport path from \"path\"\n\ninterface LiteratureReviewRequest {\n  query: string\n}\n\ninterface Article {\n  title: string\n  authors: string[]\n  publicationYear: number\n  venue: string\n  doi?: string\n  abstract: string\n  keywords: string[]\n  researchGoal: string\n  methodology: string\n  mainResults: string\n  keyContributions: string\n  limitations: string\n  confidence: \"low\" | \"medium\" | \"high\"\n  source: string\n}\n\ninterface LiteratureReviewResponse {\n  articles: Article[]\n  synthesis: {\n    fieldOverview: string\n    gapsAndChallenges: string\n    futureDirections: string\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: LiteratureReviewRequest = await request.json()\n    const { query } = body\n\n    if (!query || typeof query !== \"string\") {\n      return NextResponse.json({ error: \"Invalid query parameter\" }, { status: 400 })\n    }\n\n    const apiKey = process.env.OPENROUTER_API_KEY\n    if (!apiKey) {\n      console.error(\"[v0] Missing OPENROUTER_API_KEY\")\n      return NextResponse.json({ error: \"API key not configured\" }, { status: 500 })\n    }\n\n    console.log(\"[v0] Calling Python backend with query:\", query)\n\n    // Call Python backend\n    const response = await callPythonBackend(query, apiKey)\n    return NextResponse.json(response)\n\n  } catch (error) {\n    console.error(\"[v0] API route error:\", error)\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : \"Failed to generate literature review\" },\n      { status: 500 }\n    )\n  }\n}\n\nasync function callPythonBackend(query: string, apiKey: string): Promise<LiteratureReviewResponse> {\n  return new Promise((resolve, reject) => {\n\n    const pythonPath = \"C:\\\\Users\\\\user\\\\anaconda3\\\\envs\\\\myenv\\\\python.exe\"   // âœ… FIXED PATH\n    const scriptPath = path.join(process.cwd(), \"scripts\", \"literature_review_service.py\")\n\n    const pythonProcess = spawn(pythonPath, [scriptPath], {\n      env: {\n        ...process.env,\n        OPENROUTER_API_KEY: apiKey,\n        QUERY: query,\n      },\n    })\n\n    let stdout = \"\"\n    let stderr = \"\"\n\n    pythonProcess.stdout?.on(\"data\", (data) => {\n      stdout += data.toString()\n    })\n\n    pythonProcess.stderr?.on(\"data\", (data) => {\n      stderr += data.toString()\n    })\n\n    pythonProcess.on(\"close\", (code) => {\n      if (code !== 0) {\n        reject(new Error(`Python exited with code ${code}: ${stderr}`))\n        return\n      }\n\n      try {\n        const jsonMatch = stdout.match(/\\{[\\s\\S]*\\}/)\n        if (!jsonMatch) {\n          reject(new Error(\"No JSON output from Python service\"))\n          return\n        }\n\n        resolve(JSON.parse(jsonMatch[0]))\n      } catch (error) {\n        reject(new Error(`Failed to parse Python output: ${error}`))\n      }\n    })\n\n    pythonProcess.on(\"error\", (error) => {\n      reject(new Error(`Failed to start Python process: ${error.message}`))\n    })\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAgCO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAgC,MAAM,QAAQ,IAAI;QACxD,MAAM,EAAE,KAAK,EAAE,GAAG;QAElB,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,0MAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB;QAC7C,IAAI,CAAC,QAAQ;YACX,QAAQ,KAAK,CAAC;YACd,OAAO,0MAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,QAAQ,GAAG,CAAC,2CAA2C;QAEvD,sBAAsB;QACtB,MAAM,WAAW,MAAM,kBAAkB,OAAO;QAChD,OAAO,0MAAY,CAAC,IAAI,CAAC;IAE3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,0MAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAuC,GACzF;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,eAAe,kBAAkB,KAAa,EAAE,MAAc;IAC5D,OAAO,IAAI,QAAQ,CAAC,SAAS;QAE3B,MAAM,aAAa,sDAAwD,eAAe;;QAC1F,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,WAAW;QAEvD,MAAM,gBAAgB,IAAA,4HAAK,EAAC,YAAY;YAAC;SAAW,EAAE;YACpD,KAAK;gBACH,GAAG,QAAQ,GAAG;gBACd,oBAAoB;gBACpB,OAAO;YACT;QACF;QAEA,IAAI,SAAS;QACb,IAAI,SAAS;QAEb,cAAc,MAAM,EAAE,GAAG,QAAQ,CAAC;YAChC,UAAU,KAAK,QAAQ;QACzB;QAEA,cAAc,MAAM,EAAE,GAAG,QAAQ,CAAC;YAChC,UAAU,KAAK,QAAQ;QACzB;QAEA,cAAc,EAAE,CAAC,SAAS,CAAC;YACzB,IAAI,SAAS,GAAG;gBACd,OAAO,IAAI,MAAM,CAAC,wBAAwB,EAAE,KAAK,EAAE,EAAE,QAAQ;gBAC7D;YACF;YAEA,IAAI;gBACF,MAAM,YAAY,OAAO,KAAK,CAAC;gBAC/B,IAAI,CAAC,WAAW;oBACd,OAAO,IAAI,MAAM;oBACjB;gBACF;gBAEA,QAAQ,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;YACjC,EAAE,OAAO,OAAO;gBACd,OAAO,IAAI,MAAM,CAAC,+BAA+B,EAAE,OAAO;YAC5D;QACF;QAEA,cAAc,EAAE,CAAC,SAAS,CAAC;YACzB,OAAO,IAAI,MAAM,CAAC,gCAAgC,EAAE,MAAM,OAAO,EAAE;QACrE;IACF;AACF"}}]
}