{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Comprehensive_Literature/app/api/literature-review/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { spawn } from \"child_process\"\nimport path from \"path\"\n\ninterface LiteratureReviewRequest {\n  query: string\n  apiKey?: string\n  model?: string\n}\n\ninterface Article {\n  title: string\n  authors: string[]\n  publicationYear: number\n  venue: string\n  doi?: string\n  abstract: string\n  keywords: string[]\n  researchGoal: string\n  methodology: string\n  mainResults: string\n  keyContributions: string\n  limitations: string\n  confidence: \"low\" | \"medium\" | \"high\"\n  source: string\n}\n\ninterface LiteratureReviewResponse {\n  articles: Article[]\n  synthesis: {\n    fieldOverview: string\n    gapsAndChallenges: string\n    futureDirections: string\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: LiteratureReviewRequest = await request.json()\n    const { query, apiKey, model } = body\n\n    if (!query || typeof query !== \"string\") {\n      return NextResponse.json({ error: \"Invalid query parameter\" }, { status: 400 })\n    }\n\n    const trimmedApiKey = apiKey?.trim()\n    const finalApiKey = trimmedApiKey || process.env.OPENROUTER_API_KEY\n    const finalModel = model?.trim() || \"openai/gpt-4o-mini\"\n\n    if (!finalApiKey) {\n      console.error(\"[v0] Missing OPENROUTER_API_KEY - no custom key provided and no env variable set\")\n      return NextResponse.json(\n        { error: \"API key not configured. Please add your API key in Settings.\" },\n        { status: 500 },\n      )\n    }\n\n    if (!finalApiKey.startsWith(\"sk-\")) {\n      console.error(\"[v0] Invalid API key format - should start with sk-\")\n      return NextResponse.json({ error: \"Invalid API key format. API keys should start with 'sk-'\" }, { status: 400 })\n    }\n\n    console.log(\n      \"[v0] Calling Python backend - Query:\",\n      query,\n      \"Model:\",\n      finalModel,\n      \"Using custom key:\",\n      !!trimmedApiKey,\n    )\n\n    // Call Python backend service\n    const response = await callPythonBackend(query, finalApiKey, finalModel)\n    return NextResponse.json(response)\n  } catch (error) {\n    console.error(\"[v0] API route error:\", error)\n    const errorMessage = error instanceof Error ? error.message : \"Failed to generate literature review\"\n    return NextResponse.json({ error: errorMessage }, { status: 500 })\n  }\n}\n\nasync function callPythonBackend(query: string, apiKey: string, model: string): Promise<LiteratureReviewResponse> {\n  return new Promise((resolve, reject) => {\n    const pythonScriptPath = path.join(process.cwd(), \"scripts\", \"literature_review_service.py\")\n\n    let pythonPath = process.env.PYTHON_PATH || \"python\"\n\n    // Try common Python installation paths on Windows if python3 is not available\n    if (process.platform === \"win32\") {\n      if (!pythonPath || pythonPath === \"python\") {\n        pythonPath = \"C:\\\\Users\\\\user\\\\anaconda3\\\\envs\\\\myenv\\\\python.exe\"\n      }\n    }\n\n    console.log(\"[v0] Spawning Python process with environment variables\")\n    console.log(\"[v0] Python path:\", pythonPath)\n\n    const pythonProcess = spawn(pythonPath, [pythonScriptPath], {\n      env: {\n        ...process.env,\n        OPENROUTER_API_KEY: apiKey,\n        QUERY: query,\n        MODEL: model,\n      },\n    })\n\n    let stdout = \"\"\n    let stderr = \"\"\n\n    pythonProcess.stdout?.on(\"data\", (data) => {\n      stdout += data.toString()\n      console.log(\"[v0] Python stdout:\", data.toString())\n    })\n\n    pythonProcess.stderr?.on(\"data\", (data) => {\n      stderr += data.toString()\n      console.error(\"[v0] Python stderr:\", data.toString())\n    })\n\n    pythonProcess.on(\"close\", (code) => {\n      if (code !== 0) {\n        console.error(\"[v0] Python process failed with code:\", code, \"stderr:\", stderr)\n        reject(new Error(`Python process failed: ${stderr || \"Unknown error\"}`))\n        return\n      }\n\n      try {\n        // Extract JSON from stdout\n        const jsonMatch = stdout.match(/\\{[\\s\\S]*\\}/)\n        if (!jsonMatch) {\n          console.error(\"[v0] No JSON output found in stdout:\", stdout)\n          reject(new Error(\"No JSON output from Python service\"))\n          return\n        }\n\n        const result = JSON.parse(jsonMatch[0])\n        console.log(\"[v0] Successfully parsed Python response\")\n        resolve(result)\n      } catch (error) {\n        console.error(\"[v0] Failed to parse Python output:\", error, \"stdout:\", stdout)\n        reject(new Error(`Failed to parse Python output: ${error}`))\n      }\n    })\n\n    pythonProcess.on(\"error\", (error) => {\n      console.error(\"[v0] Failed to spawn Python process:\", error)\n      reject(new Error(`Failed to spawn Python process: ${error.message}`))\n    })\n  })\n}\n"],"names":[],"mappings":"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"}}]
}